<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ pet.name }} â€¢ Si me encontraste</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121c33; --text:#eaf0ff; --muted:#93a4c7;
      --accent:#22d3ee; --accent2:#60a5fa; --line:rgba(255,255,255,.10);
    }
    body{margin:0;background:radial-gradient(1200px 600px at 10% 0%, rgba(34,211,238,.15), transparent 50%),
                  radial-gradient(900px 500px at 90% 10%, rgba(96,165,250,.18), transparent 45%),
                  var(--bg);
         font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:var(--text);}
    .wrap{max-width:720px;margin:0 auto;padding:18px;}
    .card{background:rgba(18,28,51,.92); border:1px solid var(--line); border-radius:18px; overflow:hidden; box-shadow:0 18px 60px rgba(0,0,0,.35);}
    .hero{display:flex; gap:16px; padding:16px; align-items:center;}
    img{width:120px;height:120px; object-fit:cover; border-radius:16px; border:1px solid var(--line);}
    h1{margin:0;font-size:26px;letter-spacing:.2px;}
    .muted{color:var(--muted); margin:6px 0 0 0; line-height:1.35;}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--line); color:var(--muted); margin-top:10px;}
    .section{padding:0 16px 16px;}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    .btn{display:flex; align-items:center; justify-content:center; gap:10px;
         text-decoration:none; padding:14px 14px; border-radius:14px; font-weight:700;
         border:1px solid var(--line); color:var(--text); background:rgba(255,255,255,.03);}
    .btn:hover{transform:translateY(-1px); transition:.12s ease; border-color:rgba(34,211,238,.35);}
    .btn-primary{background:linear-gradient(90deg, rgba(34,211,238,.22), rgba(96,165,250,.22)); border-color:rgba(34,211,238,.35);}
    .box{padding:12px;border-radius:14px;border:1px solid var(--line); background:rgba(255,255,255,.03);}
    .small{font-size:13px;color:var(--muted);}
    .footer{padding:14px 16px; border-top:1px solid var(--line); display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    code{background:rgba(255,255,255,.06); padding:2px 6px; border-radius:8px; border:1px solid var(--line);}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="hero">
        <img src="{{ pet.photo }}" alt="Foto de {{ pet.name }}">
        <div>
          <h1>Hola, soy {{ pet.name }} ğŸ¾</h1>
          <p class="muted">{{ pet.breed }} â€¢ Si me encontraste, por favor contactÃ¡ a mi humano.</p>
          <div class="pill">ğŸ†” <code>{{ pet_id }}</code> â€¢ âœ… Gracias por ayudar</div>
        </div>
      </div>

      <div class="section">
        <div class="grid">
          <a class="btn btn-primary" href="tel:{{ pet.phone }}">ğŸ“ Llamar a {{ pet.owner_name }}</a>
          <a class="btn" href="https://wa.me/{{ pet.whatsapp }}?text=Hola!%20Encontr%C3%A9%20a%20{{ pet.name }}%20(%23{{ pet_id }})">ğŸ’¬ WhatsApp</a>
        </div>

        <div style="height:12px"></div>

        <div class="box">
          <div style="font-weight:800;">ğŸ§  Importante</div>
          <div class="muted">{{ pet.notes }}</div>
          <div style="height:10px"></div>
          <div class="small">Extra: {{ pet.extra }}</div>
        </div>

        <div style="height:12px"></div>

        {% if geo_enabled %}
        <div class="box" id="geoBox">
          <div style="font-weight:800;">ğŸ“ Â¿PodÃ©s compartir tu ubicaciÃ³n?</div>
          <div class="muted">Solo si aceptÃ¡s. Nos ayuda a ir a buscarlo mÃ¡s rÃ¡pido.</div>
          <div style="height:10px"></div>
          <button class="btn btn-primary" style="width:100%; cursor:pointer;" onclick="shareLocation()">Compartir ubicaciÃ³n</button>
          <div class="small" id="geoStatus" style="margin-top:10px;"></div>
        </div>
        {% endif %}
      </div>

      <div class="footer">
        <div class="small">Perfil: <code>/p/{{ pet_id }}</code></div>
        <div class="small">Gracias por no ser un NPC ğŸ«¶</div>
      </div>
    </div>
  </div>

<script>
async function shareLocation(){
  const status = document.getElementById("geoStatus");
  status.textContent = "Pidiendo ubicaciÃ³nâ€¦";

  if(!navigator.geolocation){
    status.textContent = "Este dispositivo no soporta geolocalizaciÃ³n.";
    return;
  }

  navigator.geolocation.getCurrentPosition(async (pos) => {
    try{
      const payload = {
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        accuracy: pos.coords.accuracy
      };
      const res = await fetch(`/api/scan/{{ pet_id }}`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      status.textContent = data.ok ? "âœ… UbicaciÃ³n enviada. Â¡Gracias!" : "âš ï¸ No se pudo enviar la ubicaciÃ³n.";
    }catch(e){
      status.textContent = "âš ï¸ Error enviando la ubicaciÃ³n.";
    }
  }, () => {
    status.textContent = "No se compartiÃ³ la ubicaciÃ³n (rechazado o error).";
  }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
}
</script>
</body>
</html>
