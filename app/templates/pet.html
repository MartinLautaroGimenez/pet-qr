<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ pet.name }} ‚Ä¢ Si me encontraste</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:rgba(18,28,51,.92);
      --text:#eaf0ff;
      --muted:#93a4c7;
      --line:rgba(255,255,255,.10);
      --accent:#22d3ee;
      --accent2:#60a5fa;
      --danger:#fb7185;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:
        radial-gradient(1100px 600px at 10% 0%, rgba(34,211,238,.16), transparent 55%),
        radial-gradient(900px 500px at 95% 5%, rgba(96,165,250,.18), transparent 55%),
        var(--bg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      color:var(--text);
    }
    .wrap{max-width:720px;margin:0 auto;padding:14px 14px 92px;} /* padding bottom para barra fija */
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:20px;
      overflow:hidden;
      box-shadow:0 18px 60px rgba(0,0,0,.35);
    }

    /* HERO banner */
    .hero{
      position:relative;
      width:100%;
      height:min(42vh, 340px);
      background:rgba(255,255,255,.03);
    }
    .hero img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter:saturate(1.05) contrast(1.05);
    }
    .hero:after{
      content:"";
      position:absolute; inset:0;
      background:linear-gradient(to top, rgba(11,18,32,.92), rgba(11,18,32,.10) 55%, rgba(11,18,32,.0));
      pointer-events:none;
    }
    .hero-text{
      position:absolute; left:14px; right:14px; bottom:14px;
      z-index:2;
    }
    h1{
      margin:0;
      font-size:clamp(22px, 4.8vw, 30px);
      letter-spacing:.2px;
      text-shadow:0 8px 30px rgba(0,0,0,.55);
    }
    .sub{
      margin:6px 0 0 0;
      color:rgba(234,240,255,.88);
      line-height:1.3;
      text-shadow:0 8px 30px rgba(0,0,0,.55);
      font-size:clamp(13px, 3.4vw, 15px);
    }

    .content{padding:14px;}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      background:rgba(255,255,255,.03);
      margin-top:10px;
      font-size:12px;
    }
    code{background:rgba(255,255,255,.06); padding:2px 6px; border-radius:8px; border:1px solid var(--line);}

    .box{
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
    }
    .muted{color:var(--muted);}
    .title{font-weight:900; margin-bottom:6px;}

    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media(max-width:560px){
      .grid{grid-template-columns:1fr;}
    }

    .btn{
      display:flex; align-items:center; justify-content:center; gap:10px;
      text-decoration:none;
      padding:14px 14px;
      border-radius:14px;
      font-weight:900;
      border:1px solid var(--line);
      color:var(--text);
      background:rgba(255,255,255,.03);
      font-size:16px;
    }
    .btn:hover{transform:translateY(-1px); transition:.12s ease; border-color:rgba(34,211,238,.35);}
    .btn-primary{
      background:linear-gradient(90deg, rgba(34,211,238,.22), rgba(96,165,250,.22));
      border-color:rgba(34,211,238,.35);
    }

    /* Barra fija mobile */
    .bar{
      position:fixed;
      left:0; right:0; bottom:0;
      padding:10px 12px;
      background:rgba(11,18,32,.92);
      border-top:1px solid var(--line);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex;
      justify-content:center;
      z-index:50;
    }
    .bar-inner{
      width:min(720px, 100%);
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .bar .btn{padding:14px 10px; border-radius:16px;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="hero">
        <img src="{{ pet.photo }}" alt="Foto de {{ pet.name }}">
        <div class="hero-text">
          <h1>Hola, soy {{ pet.name }} üêæ</h1>
          <div class="sub">{{ pet.breed }} ‚Ä¢ Si me encontraste, por favor contact√° a mi humano.</div>
          <div class="pill">üÜî <code>{{ pet_id }}</code> ‚Ä¢ ‚úÖ Gracias por ayudar</div>
        </div>
      </div>

      <div class="content">
        <div class="grid">
          <a class="btn btn-primary" href="tel:{{ pet.phone }}">üìû Llamar a {{ pet.owner_name }}</a>
          <a class="btn" href="https://wa.me/{{ pet.whatsapp }}?text=Hola!%20Encontr%C3%A9%20a%20{{ pet.name }}%20(%23{{ pet_id }})">üí¨ WhatsApp</a>
        </div>

        <div style="height:12px"></div>

        <div class="box">
          <div class="title">üß† Importante</div>
          <div class="muted">{{ pet.notes }}</div>
          <div style="height:10px"></div>
          <div class="muted" style="font-size:13px;">Extra: {{ pet.extra }}</div>
        </div>

        {% if geo_enabled %}
          <div style="height:12px"></div>
          <div class="box" id="geoBox">
            <div class="title">üìç ¬øPod√©s compartir tu ubicaci√≥n?</div>
            <div class="muted">Solo si acept√°s. Nos ayuda a ir a buscarlo m√°s r√°pido.</div>
            <div style="height:10px"></div>
            <button class="btn btn-primary" style="width:100%; cursor:pointer;" onclick="shareLocation()">Compartir ubicaci√≥n</button>
            <div class="muted" id="geoStatus" style="margin-top:10px; font-size:13px;"></div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Barra fija (mejor UX en celular) -->
  <div class="bar">
    <div class="bar-inner">
      <a class="btn btn-primary" href="tel:{{ pet.phone }}">üìû Llamar</a>
      <a class="btn" href="https://wa.me/{{ pet.whatsapp }}?text=Hola!%20Encontr%C3%A9%20a%20{{ pet.name }}%20(%23{{ pet_id }})">üí¨ WhatsApp</a>
    </div>
  </div>

<script>
async function shareLocation(){
  const status = document.getElementById("geoStatus");
  status.textContent = "Pidiendo ubicaci√≥n‚Ä¶";

  if(!navigator.geolocation){
    status.textContent = "Este dispositivo no soporta geolocalizaci√≥n.";
    return;
  }

  navigator.geolocation.getCurrentPosition(async (pos) => {
    try{
      const payload = {
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        accuracy: pos.coords.accuracy
      };
      const res = await fetch(`/api/scan/{{ pet_id }}`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      status.textContent = data.ok ? "‚úÖ Ubicaci√≥n enviada. ¬°Gracias!" : "‚ö†Ô∏è No se pudo enviar la ubicaci√≥n.";
    }catch(e){
      status.textContent = "‚ö†Ô∏è Error enviando la ubicaci√≥n.";
    }
  }, () => {
    status.textContent = "No se comparti√≥ la ubicaci√≥n (rechazado o error).";
  }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
}
</script>
</body>
</html>
